# ADR-001: アーキテクチャ選定

## 文脈

書籍・著者管理機能（登録・更新、および著者別に書籍を取得）を実装する Kotlin/Spring Boot プロジェクトを新規構築している。ビジネスルールには以下が含まれる:

- 書籍: タイトル必須、価格は 0 以上、著者は 1 名以上で複数可、出版済みから未出版への変更は禁止。
- 著者: 名前必須、生年月日は現在よりも過去でなければならない、複数書籍を執筆可能。

クリーンアーキテクチャ（参考: [buckpal](https://github.com/thombergs/buckpal)）とレイヤードアーキテクチャの採用を比較検討した。

## 意思決定ドライバ

1. **ドメインの拡張性**: 今後ユースケースや外部インターフェースが増加する可能性を考慮し、ドメインモデルを保護しやすい構造を重視したい。
2. **テスト容易性**: ユースケース単位・ドメイン単位での単体テストを重視しており、層の責務を分けた方がテストが書きやすい。
3. **参考実装の存在**: buckpal リポジトリなどクリーンアーキテクチャのガイドがあり、ベースラインとして活用できる。
4. **クリーンアーキテクチャへの習熟**: クリーンアーキテクチャに精通しているわけではないが、AI エージェントやドキュメントでキャッチアップできる環境を整備する方針。
5. **長期運用コスト**: 初期構築コストは上がるものの、将来の変更に強い体系を優先したい。

対してレイヤードアーキテクチャは初期実装が容易であり、過度な抽象化を避けられる点で魅力があるが、拡張時に依存の再整理やテストの分離に追加コストが見込まれる。

## 決定

クリーンアーキテクチャを採用する。
- ドメイン層、アプリケーション層、インフラ層、インターフェース層を明確に分離する。
- ポート（リポジトリなど）を介して外部依存を隔離し、ユースケースはポート経由でドメインモデルを操作する。
- 起動時にはデフォルトで `local` プロファイルを使い、プロファイルごとの設定は `application-*.properties` に分割する方針とする。

## 影響

- プロジェクト構成を再編し、パッケージとモジュールをクリーンアーキテクチャに沿って配置する必要がある。
- ドメイン/ユースケース/アダプタをまたぐテスト構成を整備する必要がある。
- ドキュメント（Mermaid 図など）と README を用意し、チーム内での共有を図る。
- レイヤードから段階的に移行する場合に比べて初期コストは高いが、今後の機能追加や外部システム連携に柔軟に対応できる。

## 代替案

1. **レイヤードアーキテクチャ**
   - 利点: 初期実装が短期間で済む。既存の Spring Boot チュートリアルに近く、学習コストが低い。
   - 欠点: ドメインとインフラの結合度が高くなりやすく、ユースケースのテストが重くなる。将来的な再構成に数週間規模のコストが発生しやすい。

2. **ヘキサゴナル／オニオンアーキテクチャ**
   - クリーンアーキテクチャと思想が近いが表現が異なる。採用してもよいが、参考リポジトリとの整合性を重視しクリーンアーキテクチャを優先。

3. **モジュラーモノリス**
   - Spring Modulith 等でモジュールを切る案。将来的には検討余地があるが、現状はシンプルなクリーンアーキテクチャの方針でスタートする。

## ステータス

提案受理 (2025-09-21)

## フォローアップ

- ドメイン・アプリケーション・インフラの各層を順次実装する。
- ドキュメント（構成図、ディレクトリ構成、テスト方針）を整備する。
- CI/CD で層別テストが回るよう設定する。
